# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/xmlada/xmlada.conf
# Copyright (C) 2022 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

gprbuild_extract() {
	tar -xf ../archdir/gprbuild-*.tar.*
	tar -xf ../archdir/gprconfig_kb-*.tar.*
	mv gprconfig_kb-* gprconfig_kb
	mv gprbuild-* gprbuild
}

gprbuild_bootstrap() {
	if ! which gprbuild >/dev/null; then
		# XML/Ada has a circular dependency with gprbuild; build using bootstrapped gprbuild
		cd gprbuild
		CC=$HOSTCC ./bootstrap.sh --with-xmlada=.. --with-kb=../gprconfig_kb --prefix=../bootstrap
		cd ..
		export PATH=$PATH:$PWD/bootstrap/bin
	fi
}

hook_add prepatch 2 gprbuild_extract
hook_add preconf 2 gprbuild_bootstrap
