# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/gprbuild/gprbuild.conf
# Copyright (C) 2022 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

gprconfig_extract() {
	tar -xf ../archdir/gprconfig_kb-*.tar.*
	mv gprconfig_kb-* gprconfig_kb
	# Note: gprbuild bootstrap needs xmlada source, not installed xmlada
	tar -xf ../archdir/xmlada-*.tar.*
	mv xmlada-* xmlada
}

gprbuild_bootstrap() {
	if ! which gprbuild >/dev/null; then
		# gprbuild requires itself to build
		CC=$HOSTCC ./bootstrap.sh --with-xmlada=./xmlada --with-kb=./gprconfig_kb --prefix=./bootstrap
		export PATH=$PATH:$PWD/bootstrap/bin
	fi
}

hook_add prepatch 2 gprconfig_extract
hook_add preconf 2 gprbuild_bootstrap
